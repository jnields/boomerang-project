!function(e){function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}var t={};r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="/public/build/",r(r.s=68)}([function(e,r,t){"use strict";var n=t(15),a=t(14),o=t(11),u=t(12),s=t(13);t.d(r,"d",function(){return o.a}),t.d(r,"b",function(){return a.a}),t.d(r,"c",function(){return n.a}),t.d(r,"e",function(){return u.a}),t.d(r,"a",function(){return s.a}),n.a.belongsTo(a.a,{onDelete:"CASCADE"}),n.a.belongsTo(o.a,{onDelete:"SET NULL"}),n.a.belongsTo(s.a,{onDelete:"SET NULL"}),s.a.belongsTo(a.a,{onDelete:"CASCADE"}),s.a.hasMany(n.a,{onDelete:"SET NULL"}),u.a.belongsTo(n.a,{onDelete:"CASCADE"}),o.a.hasMany(n.a,{onDelete:"SET NULL"}),o.a.hasMany(a.a,{onDelete:"SET NULL"}),a.a.hasMany(n.a,{onDelete:"CASCADE"}),a.a.hasMany(s.a,{onDelete:"CASCADE"}),a.a.belongsTo(o.a,{onDelete:"SET NULL"})},function(e,r,t){"use strict";var n=t(3),a=t.n(n);r.a=new a.a("boomerang",process.env.DB_USER,process.env.DB_PASSWORD)},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("sequelize")},function(e,r,t){"use strict";function n(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function o(e){return"[object Object]"===Object.prototype.toString.call(e)}function u(e,r,t){function n(r){if(o(r))throw new d.b("Object passed to operand"+t);if("\0"===r)return null;switch(e.type.constructor.key){case"STRING":case"CHAR":case"TEXT":return r;case"INTEGER":case"BIGINT":var n=parseFloat(r,10);if(Number.isInteger(n))return n;throw new d.b("invalid value passed to "+e.fieldName);case"FLOAT":case"REAL":case"DOUBLE":case"DECIMAL":var a=parseFloat(r,10);if(!isNaN(a))return a;throw new d.b("invalid value passed to "+e.fieldName);case"BOOLEAN":switch(r){case"true":return!0;case"false":return!1;default:throw new d.b("invalid value passed to "+e.fieldName)}case"TIME":case"DATE":case"DATEONLY":var u=Date.parse(r);if(!isNaN(u))return u;throw new d.b("invalid value passed to "+e.fieldName);case"BLOB":case"UUID":throw new d.b("cannot query "+e.name);case"ENUM":if(-1===e.values.indexOf(r))throw new d.b("invalid value passed to "+e.fieldName);return r;default:throw new Error("unhandled type in switch")}}return Array.isArray(r)?r.map(n):n(r)}function s(e,r,t){var o=t.attributes[e];return Object.keys(r).reduce(function(t,s){var i=u(o,r[s],s);switch(s){case"$in":case"$notIn":return l({},t,a({},e,l(a({},s,Array.isArray(i)?i:[i]),t.param)));case"$ne":case"$gt":case"$gte":case"$lt":case"$lte":case"$like":case"$notLike":return Array.isArray(i)?l({},t,{$and:[].concat(n(i.map(function(r){return a({},e,r)})),n(t.$and||[]))}):l({},t,a({},e,l(a({},s,i),t[e])));default:throw new d.b("no such operator: "+s)}},{})}function i(e,r,t){var n=t.attributes[e];if(void 0===n||n.references)throw new d.b("no such property: "+e);if(o(r))return s(e,r,t);var i=u(n,r);return Array.isArray(i)?a({},e,{$in:i}):a({},e,i)}function c(e,r,t){var n=(r.include||[]).reduce(function(e,r){return l({},e,a({},r.model.name,r))},{});return Object.keys(e).reduce(function(r,u){if(n[u]){if("\0"===e[u])return l({},r,{where:l(a({},u+"Id",null),r.where)});if(!o(e[u]))throw new d.b("cannot query "+u+", query properties instead");return n[u].where=c(e[u],{where:n[u].where,include:n[u].include},n[u].model).where,r}switch(u){case"$order":return l({},r,{order:(Array.isArray(e[u])?e[u]:[e[u]]).map(function(e){if(void 0===t.attributes[e])throw new d.b("no such property: "+e);return e})});case"$attributes":return l({},r,{attributes:(Array.isArray(e[u])?e[u]:[e[u]]).map(function(e){var r=t.attributes[e];if(console.log(t.attributes),void 0===r||r.references)throw new d.b("no such property: "+e);return e})});case"$limit":return l({},r,{limit:Math.min(parseInt(e.$limit,10)||f.a,f.b)});case"$offset":return l({},r,{offset:parseInt(e.$offset,10)||0});default:return l({},r,{where:l({},i(u,e[u],t),r.where)})}},r)}r.a=c;var f=t(32),d=t(5),l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}},function(e,r,t){"use strict";function n(e){var r=this,t=Error.apply(this,e);Object.getOwnPropertyNames(t).forEach(function(e){r[e]=t[e]})}function a(){var e=this;Object.setPrototypeOf(this,Error),this.prototype=Object.create(Error.prototype,{name:{value:this.name},constructor:{value:this}}),this.prototype.toString=function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];return Error.prototype.toString.apply(e,t)}}function o(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];n.bind(this)(r)}function u(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];n.bind(this)(r)}function s(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];n.call.apply(n,[this].concat(r))}function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];n.bind(this)(r)}r.d=o,r.b=u,r.a=s,r.c=i,[o,u].forEach(function(e){return a.call(e)})},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}r.a=function(e){var r=this;return function(){var t=n(regeneratorRuntime.mark(function t(n,a,o){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e(n,a);case 3:return r.abrupt("return",r.sent);case 6:return r.prev=6,r.t0=r.catch(0),r.abrupt("return",o(r.t0));case 9:case"end":return r.stop()}},t,r,[[0,6]])}));return function(e,r,n){return t.apply(this,arguments)}}()}},function(e,r,t){"use strict";function n(e){switch(e.type){case"ADMIN":case"STUDENT":case"LEADER":case"TEACHER":default:return e.toJSON()}}r.a=n},function(e,r){e.exports=require("crypto")},function(e,r,t){"use strict";var n=t(1);r.a=function(){return n.a.transaction({autocommit:!1,isolationLevel:"READ COMMITTED"})}},function(e,r,t){"use strict";var n=t(64),a=(t.n(n),{sendmail:!0,newline:"unix",path:"/usr/sbin/sendmail"});r.a=t.i(n.createTransport)(a)},function(e,r,t){"use strict";var n=t(3),a=(t.n(n),t(1));r.a=a.a.define("address",{line1:n.STRING,line2:n.STRING,line3:n.STRING,city:n.STRING,state:n.STRING,zip:{type:n.STRING,is:/^[0-9]{5}(-[0-9]{4})?$/},country:n.STRING})},function(e,r,t){"use strict";function n(e,r){return{salt:e,hash:s.a.createHmac("sha512",e).update(r).digest("base64")}}function a(e){if(null==e)throw new Error("null password");return n(s.a.randomBytes(16).toString("base64"),e)}function o(e,r,t){if(null==e||null==r||null==t)return!1;for(var a=n(e,t).hash,o=1,u=0;u<a.length;u+=1)o&=r[u]===a[u];return 1===o}var u=t(8),s=t.n(u),i=t(3),c=(t.n(i),t(1)),f=t(5);r.a=c.a.define("authMechanism",{type:{type:t.i(i.ENUM)("BASIC"),allowNull:!1},username:{type:i.STRING,unique:!0,allowNull:!1},salt:t.i(i.CHAR)(24),hash:t.i(i.CHAR)(88),sessionId:t.i(i.CHAR)(88),resetId:t.i(i.CHAR)(88),resetAt:i.DATE},{instanceMethods:{correctPassword:function(e){return o(this.salt,this.hash,e)},setPassword:function(e){if(e.length<8)throw new f.d;var r=a(e);this.salt=r.salt.toString("base64"),this.hash=r.hash.toString("base64")}}})},function(e,r,t){"use strict";var n=t(3),a=(t.n(n),t(1));r.a=a.a.define("group",{name:n.STRING,roomNumber:n.STRING,notes:t.i(n.STRING)(2550)})},function(e,r,t){"use strict";var n=t(3),a=(t.n(n),t(1));r.a=a.a.define("school",{name:n.STRING})},function(e,r,t){"use strict";var n=t(3),a=(t.n(n),t(1));r.a=a.a.define("user",{firstName:n.STRING,lastName:n.STRING,middleName:n.STRING,phone:n.STRING,email:n.STRING,firstLanguage:n.STRING,languageNeeds:t.i(n.STRING)(2550),notes:t.i(n.STRING)(2550),gender:t.i(n.ENUM)("M","F"),dob:n.DATEONLY,homeRoom:n.STRING,teacher:n.STRING,oriented:n.BOOLEAN,activationSent:{type:n.BOOLEAN,allowNull:!1,defaultValue:!1},type:{type:t.i(n.ENUM)("STUDENT","LEADER","TEACHER","ADMIN"),allowNull:!1}})},function(e,r,t){"use strict";var n=t(8),a=t.n(n);r.a=function(e,r){var t=r||a.a.randomBytes(64).toString("base64");return e.cookie("SID",t,{secure:"production"===process.env.NODE_ENV,maxAge:31536e7}),t}},function(e,r,t){"use strict";function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(e,t,n){return-1===[].indexOf.call(r,e.user.type)?t.status(401).send({error:"unauthorized"}):n()}}r.a=n},function(e,r,t){"use strict";r.a=function(e,r,t){return null==e.user?r.status(403).send({error:"unauthenticated"}):t()}},function(e,r){e.exports=require("buffer/index.js")},function(e,r){e.exports=require("normalizr")},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(24),a=t(56),o=t(54);t.i(a.a)(t.i(n.a)(o.a))},function(e,r){e.exports=require("babel-polyfill")},function(e,r,t){"use strict";t.d(r,"a",function(){return s});var n=t(20),a=(t.n(n),n.schema.Entity),o=new a("groups"),u=new a("addresses"),s=(new a("schools",{address:u}),new a("users",{address:u,group:o}))},function(e,r,t){"use strict";var n=t(2),a=t.n(n),o=t(66),u=t.n(o),s=t(67),i=t.n(s),c=t(63),f=t.n(c),d=t(59),l=t.n(d),p=t(60),h=t.n(p),v=t(57),m=t.n(v),b=t(25);!function(){var e=["DB_USER","DB_PASSWORD","PORT","HOST","MAIL_USER"];"production"!==process.env.NODE_ENV&&e.push("PROXY_PORT"),e.forEach(function(e){if(!process.env[e])throw new Error("Environment variable '"+e+"' not defined.")})}(),r.a=function(e){var r=a()();return r.use(l()()),r.set("views",u.a.resolve(__dirname,"src","server","views")),r.set("view engine","pug"),r.use(i()(u.a.resolve(__dirname,"src","assets","favicon.ico"))),r.use(f()("dev")),r.use(m.a.json()),r.use(m.a.urlencoded({extended:!0})),r.use(h()()),r.use("/public",a.a.static(u.a.resolve(__dirname,"public"))),r.use(b.a),r.use(e),r.use(function(e,r,t){var n=new Error("Not Found");n.status=404,t(n)}),"production"===process.env.NODE_ENV?r.use(function(e,r,t,n){t.status(e.status||500),t.render("error",{message:e.message,error:{}})}):r.use(function(e,r,t,n){t.status(e.status||500),t.render("error",{message:e.message,error:e})}),r}},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){function e(e,t,n){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t,n){var o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(o=r.cookies.SID)||!o.length){e.next=9;break}return e.next=5,a.e.findOne({where:{sessionId:o},include:[{model:a.c,include:[{model:a.b}]}]});case 5:u=e.sent,r.user=u&&u.user?u.user:null,e.next=10;break;case 9:r.user=null;case 10:return e.abrupt("return",n());case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",n(e.t0));case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return e}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(8),o=t.n(a),u=t(4),s=t(0),i=t(10),c=t(9),f=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},d=this,l=function(){function e(e,r){var t=[],n=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,a,u,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.e.findOrCreate({where:{username:t.email},defaults:{type:"BASIC",username:t.email},transaction:r});case 2:return n=e.sent,a=l(n,1),u=a[0],c=o.a.randomBytes(32),f=u.update({userId:t.id,resetId:c.toString("base64"),resetAt:new Date},{transaction:r}),i.a.sendMail({from:process.env.MAIL_USER,to:t.email,subject:"Activate your account with Boomerang Project",text:"\nYou've been granted access to the Boomerang Project's data manager.\n\nTo set a password to activate your account, follow the link below:\n\n"+process.env.HOST+"/activate/"+c.toString("hex")+"\n\nThanks,\nYour friends at the Boomerang Project\n"}).then(function(e){return console.log(e)},function(e){return console.error(e)}),e.abrupt("return",f);case 9:case"end":return e.stop()}},e,d)}));return function(r,t){return e.apply(this,arguments)}}();r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,n){var a,o,i,l,h,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.transaction,o=f({},r.query),i=o.schoolId,delete o.schoolId,l=t.i(u.a)(o,{transaction:a,where:{activationSent:!1,$and:[{email:{$ne:null}},{email:{$ne:""}}]}},s.c),void 0!==i&&(l.where.schoolId=i),e.next=8,s.c.findAll(f({},l,{include:[{model:s.a},{model:s.d}]}));case 8:return h=e.sent,e.next=11,s.c.update({activationSent:!0},l);case 11:return e.next=13,a.commit();case 13:return n.status(202).send(h.map(function(e){return f({},e.toJSON(),{activationSent:!0})})),e.next=16,t.i(c.a)();case 16:return v=e.sent,e.prev=17,e.next=20,Promise.all(h.map(p.bind(null,v)));case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(17),v.rollback();case 25:return e.prev=25,v.finished||v.commit(),e.finish(25);case 28:case"end":return e.stop()}},e,d,[[17,22,25,28]])}));return function(r,t){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";var n=t(2),a=(t.n(n),t(28)),o=t(30),u=t(31),s=t(29),i=t(26),c=t(6),f=t(17),d=t(18),l=t.i(n.Router)();l.route("/login").post(t.i(c.a)(a.a)),l.route("/activate").all(d.a,t.i(f.a)("ADMIN")).post(t.i(c.a)(i.a)),l.route("/login/:id").all(d.a,t.i(f.a)("ADMIN")).patch(t.i(c.a)(s.a)),l.route("/reset").put(t.i(c.a)(u.a)).post(t.i(c.a)(o.a)),r.a=l},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(16),u=t(7);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,n){var s,i,c,f,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r.transaction,(i=r.body)&&i.username&&i.password){e.next=5;break}return e.next=4,s.rollback();case 4:return e.abrupt("return",n.status(400).send({error:"bad request"}));case 5:return c=i.username,f=i.password,e.next=8,a.e.findOne({transaction:s,where:{username:c},include:[{model:a.c,include:[{model:a.b}]}]});case 8:if(null!=(d=e.sent)&&d.correctPassword(f)){e.next=13;break}return e.next=12,s.rollback();case 12:return e.abrupt("return",n.status(422).send({error:"invalid username / password"}));case 13:if(l=t.i(o.a)(n,d.sessionId),d.sessionId===l){e.next=17;break}return e.next=17,d.update({sessionId:l,transaction:s});case 17:return e.next=19,r.transaction.commit();case 19:return e.abrupt("return",n.send(t.i(u.a)(d.user)));case 20:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";(function(e){function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=function(){function e(e,r){var t=[],n=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=e.alloc(16,0).toString("base64"),s=e.alloc(64,0).toString("base64");r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,i,c,f,d,l,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.id,i=r.transaction,e.next=4,a.c.findOne({where:{id:n},transaction:i});case 4:if(null!=(c=e.sent)){e.next=7;break}return e.abrupt("return",t.status(404).send({error:"not found"}));case 7:return f=r.body,e.next=10,a.e.findOrCreate({where:{userId:n},defaults:{type:"BASIC",salt:u,hash:s,userId:n},transaction:i});case 10:if(d=e.sent,l=o(d,1),p=l[0],!f.password){e.next=17;break}p.setPassword(f.password),e.next=21;break;case 17:if(p.salt!==u&&p.hash!==s){e.next=21;break}return e.next=20,i.rollback();case 20:return e.abrupt("return",t.status(400).send({error:"bad request"}));case 21:return p.username=f.username||c.email,e.next=24,p.save({transaction:i});case 24:return e.next=26,i.commit();case 26:return e.abrupt("return",t.status(204).send());case 27:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()}).call(r,t(19).Buffer)},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(8),o=t.n(a),u=t(0),s=t(10),i=function(){function e(e,r){var t=[],n=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){var n,a,c,f,d,l,p,h,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.status(202).send(),n=r.transaction,a=r.body,c=void 0===a?{}:a,e.next=4,Promise.all([u.c.findOne({where:{email:c.username},transaction:n}),u.e.findOrCreate({where:{username:c.username},defaults:{type:"BASIC",username:c.username},transaction:n})]);case 4:if(f=e.sent,d=i(f,2),l=d[0],p=i(d[1],1),h=p[0],null!=l){e.next=12;break}return e.next=12,n.rollback();case 12:return v=o.a.randomBytes(64),e.next=15,h.update({userId:l.id,resetId:v.toString("base64"),resetAt:new Date},{transaction:n});case 15:return e.next=17,n.commit();case 17:return e.prev=17,e.next=20,s.a.sendMail({from:process.env.MAIL_USER,to:l.email,subject:"Boomerang Project Password Reset",text:"Somebody recently requested that your password for boomerangproject.com be reset.\n\nTo choose a new one, please visit the following link:\n\n"+process.env.HOST+"/reset/"+v.toString("hex")+"\n\nIf this was a mistake, simply ignore this e-mail.\n\nThanks,\nYour friends at the Boomerang Project"});case 20:m=e.sent,console.log(m),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(17),console.log(e.t0);case 27:case"end":return e.stop()}},e,this,[[17,24]])}));return e}()},function(e,r,t){"use strict";(function(e){function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(16),u=t(7);r.a=function(){function r(e,r){return s.apply(this,arguments)}var s=n(regeneratorRuntime.mark(function r(n,s){var i,c,f,d,l;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n.transaction,(c=n.body)&&c.resetId&&c.password){r.next=5;break}return r.next=4,i.rollback();case 4:return r.abrupt("return",s.status(400).send({error:"bad request"}));case 5:f=c.password,d=void 0,r.prev=7,d=e.from(c.resetId,"hex").toString("base64"),r.next=15;break;case 11:return r.prev=11,r.t0=r.catch(7),d=null,r.abrupt("return",s.status(422).send({error:"expired"}));case 15:return r.next=17,a.e.findOne({transaction:i,where:{resetId:d,resetAt:{$gt:new Date(+new Date-864e5)}},include:[{model:a.c,include:[{model:a.b}]}]});case 17:if(null!=(l=r.sent)){r.next=20;break}return r.abrupt("return",s.status(422).send({error:"expired"}));case 20:return l.setPassword(f),l.sessionId=t.i(o.a)(s),l.resetId=null,r.next=25,l.save({transaction:i});case 25:return r.next=27,i.commit();case 27:return r.abrupt("return",s.send(t.i(u.a)(l.user)));case 28:case"end":return r.stop()}},r,this,[[7,11]])}));return r}()}).call(r,t(19).Buffer)},function(e,r,t){"use strict";t.d(r,"b",function(){return n}),t.d(r,"a",function(){return a});var n=1e3,a=10},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(4),u=this,s=function(){var e=n(regeneratorRuntime.mark(function e(r,n){var s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.transaction,i=t.i(o.a)(r.query,{transaction:s,where:{schoolId:r.user.schoolId}},a.a),e.next=4,a.a.destroy(i);case 4:return e.next=6,s.commit();case 6:n.status(204).send();case 7:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}(),i=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,o,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.id,o=r.transaction,s=[],r.user.school&&s.push({model:a.b,where:{id:r.user.school.id}}),e.next=6,a.a.findOne({where:{id:n},transaction:o,include:s});case 6:if(!(i=e.sent)){e.next=13;break}return e.next=10,i.destroy({transaction:o});case 10:return e.next=12,o.commit();case 12:return e.abrupt("return",t.status(204).send());case 13:return e.next=15,o.rollback();case 15:return e.abrupt("return",t.status(404).send());case 16:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}();r.a=function(e,r){return"id"in e.params?i(e,r):s(e,r)}},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,o,u,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.transaction,o={model:a.b},u=[o],r.user.school&&(o.where={id:r.user.school.id}),e.next=6,a.a.findOne({where:{id:r.params.id},include:u,transaction:n});case 6:if(!(s=e.sent)){e.next=16;break}return e.next=10,n.commit();case 10:i=s.toJSON(),delete i.school,delete i.schoolId,t.json(s),e.next=19;break;case 16:return e.next=18,n.rollback();case 18:t.status(404).send({error:"not  found"});case 19:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";var n=t(2),a=(t.n(n),t(6)),o=t(33),u=t(36),s=t(37),i=t(38),c=t(34),f=t.i(n.Router)();f.route("/").get(t.i(a.a)(i.a)).post(t.i(a.a)(s.a)).delete(t.i(a.a)(o.a)),f.route("/:id").delete(t.i(a.a)(o.a)).get(t.i(a.a)(c.a)).patch(t.i(a.a)(u.a)),r.a=f},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,o,u,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,o=r.transaction,!(n.schoolId||n.school||n.users)){e.next=6;break}return e.next=5,o.rollback();case 5:return e.abrupt("return",t.status(400).send({error:"bad request"}));case 6:return e.next=8,a.a.findOne({where:{id:r.params.id},transaction:o});case 8:if(u=e.sent){e.next=13;break}return e.next=12,o.rollback();case 12:return e.abrupt("return",t.status(404).send({error:"not found"}));case 13:return e.next=15,u.update(n,{transaction:o});case 15:return s=e.sent,e.next=18,o.commit();case 18:return i=s.toJSON(),delete i.school,delete i.schoolId,e.abrupt("return",t.json(i));case 22:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(1),u=this,s=function(){function e(e,r){var t=[],n=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},c=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,c,f,d,l,p,h,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.body,c=r.transaction,n=r.user.school?n.map(function(e){return i({},e,{school:void 0,schoolId:r.user.schoolId})}):n.map(function(e){var r=e.schoolId||(e.school||{}).id;return r?i({},e,{school:void 0,schoolId:r}):t.status(400).send({error:"bad request"})}),e.next=5,a.a.bulkCreate(n,{transaction:c});case 5:return f=e.sent,e.next=8,o.a.query("SELECT LAST_INSERT_ID() lastId;",{transaction:c});case 8:return d=e.sent,l=s(d,1),p=s(l[0],1),h=p[0].lastId,e.next=14,c.commit();case 14:return v=f.map(function(e,r){return i({},e.toJSON(),{id:h+r})}),e.t0=t.status(201),e.next=18,Promise.all(v);case 18:return e.t1=e.sent,e.abrupt("return",e.t0.send.call(e.t0,e.t1));case 20:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}(),f=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,o,s,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,o=r.transaction,!r.user.school){e.next=6;break}n.schoolId=r.user.school.id,e.next=10;break;case 6:if(s=n.schoolId||(n.school||{}).id){e.next=9;break}return e.abrupt("return",t.status(400).send({error:"bad request"}));case 9:n.schoolId=s;case 10:return delete n.school,e.next=13,a.a.create(n,{transaction:o,include:[{model:a.b,include:[{model:a.d}]}]});case 13:return i=e.sent,e.next=16,o.commit();case 16:return c=i.toJSON(),delete c.school,delete c.schoolId,e.abrupt("return",t.set("Location","/groups/"+c.id).status(201).send(c));case 20:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}();r.a=function(e,r){return Array.isArray(e.body)?c(e,r):f(e,r)}},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(4);r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,n){var u,s,i,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.transaction,s=[{model:a.b,where:r.user.school?{id:r.user.school.id}:void 0,include:[{model:a.d}]}],e.next=4,a.a.findAndCount(t.i(o.a)(r.query,{transaction:u,include:s},a.a));case 4:return i=e.sent,c=i.rows,f=i.count,e.next=9,u.commit();case 9:return e.abrupt("return",n.send({count:f,results:c.map(function(e){var r=e.toJSON();return delete r.school,delete r.schoolId,r})}));case 10:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(3),o=(t.n(a),t(5));r.a=function(){var e=n(regeneratorRuntime.mark(function e(r,t,n,u){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.transaction.finished){e.next=4;break}return e.next=4,t.transaction.rollback();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:e.t1=r.constructor,e.next=e.t1===a.UniqueConstraintError?12:e.t1===o.a?13:e.t1===o.b?14:e.t1===o.c?14:e.t1===o.d?15:16;break;case 12:return e.abrupt("return",n.status(409).send(r.errors?r.errors:r));case 13:return e.abrupt("return",n.status(404).send({error:r.message||"not found"}));case 14:return e.abrupt("return",n.status(400).send({error:r.message||"bad request"}));case 15:return e.abrupt("return",n.status(422).send({error:"password does not meet length requirements"}));case 16:return console.error(r),e.abrupt("return",n.status(500).send({error:"server error"}));case 18:case"end":return e.stop()}},e,this,[[0,6]])}));return function(r,t,n,a){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";function n(e,r,n){t.i(u.a)().then(function(r){e.transaction=r,e.on("close",function(){try{r.rollback()}catch(e){}}),n()},function(e){console.log(e),r.status(500).send()})}function a(e,r,t){r.type("json"),t()}var o=t(2),u=(t.n(o),t(9)),s=t(39),i=t(17),c=t(18),f=t(27),d=t(44),l=t(50),p=t(35),h=t(41),v=t.i(o.Router)();v.use(n,a),v.use("/auth",f.a),v.use("/schools",c.a,t.i(i.a)("ADMIN"),d.a),v.use("/users",c.a,t.i(i.a)("ADMIN","TEACHER"),l.a),v.use("/groups",c.a,t.i(i.a)("ADMIN","TEACHER"),p.a),v.use("/reports",c.a,t.i(i.a)("TEACHER"),h.a),v.use(s.a),r.a=v},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(2),o=(t.n(a),t(0)),u=this;r.a=(new a.Router).get("/groups",function(){var e=n(regeneratorRuntime.mark(function e(r,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,o.a.findAll({transaction:r.transaction,include:[{model:o.b,where:{id:r.user.schoolId}},{model:o.c,include:[{model:o.d}]}],order:["name"]});case 3:e.t1=function(e){var r=e.toJSON();return delete r.school,delete r.schoolId,r},e.t2=e.sent.map(e.t1),e.t0.send.call(e.t0,e.t2),r.transaction.commit();case 7:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}()).get("/students",function(){var e=n(regeneratorRuntime.mark(function e(r,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,o.c.findAll({transaction:r.transaction,include:[{model:o.a},{model:o.b,where:{id:r.user.schoolId}},{model:o.d}],order:["lastName","firstName"],where:{type:"STUDENT"}});case 3:e.t1=function(e){var r=e.toJSON();return delete r.schoolId,delete r.school,r},e.t2=e.sent.map(e.t1),e.t0.send.call(e.t0,e.t2),r.transaction.commit();case 7:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}()).get("/leaders",function(){var e=n(regeneratorRuntime.mark(function e(r,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,o.c.findAll({transaction:r.transaction,include:[{model:o.a},{model:o.b,where:{id:r.user.schoolId}},{model:o.d}],order:["lastName","firstName"],where:{type:"LEADER"}});case 3:e.t1=function(e){var r=e.toJSON();return delete r.schoolId,delete r.school,r},e.t2=e.sent.map(e.t1),e.t0.send.call(e.t0,e.t2),r.transaction.commit();case 7:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}())},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){var n,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.params.id,o=r.transaction,null!=n){e.next=6;break}return e.next=5,o.rollback();case 5:return e.abrupt("return",t.status(400).send({error:"no id specified to delete"}));case 6:return e.next=8,a.b.destroy({where:{id:n},limit:1,transaction:o});case 8:if(!(u=e.sent)){e.next=13;break}return e.next=12,o.commit();case 12:return e.abrupt("return",t.status(204).end());case 13:return e.next=15,o.rollback();case 15:return e.abrupt("return",t.status(404).end());case 16:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){var n,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.transaction,o=r.params.id,e.next=4,a.b.findOne({where:{id:o},transaction:n});case 4:if(!(u=e.sent)){e.next=9;break}return e.next=8,n.commit();case 8:return e.abrupt("return",t.send(u));case 9:return e.next=11,n.rollback();case 11:return e.abrupt("return",t.status(404).send({error:"not found"}));case 12:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";var n=t(2),a=(t.n(n),t(6)),o=t(42),u=t(43),s=t(45),i=t(46),c=t(47),f=t.i(n.Router)();f.route("/").get(t.i(a.a)(c.a)).post(t.i(a.a)(i.a)),f.route("/:id").delete(t.i(a.a)(o.a)).get(t.i(a.a)(u.a)).patch(t.i(a.a)(s.a)),r.a=f},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=function(){var e=n(regeneratorRuntime.mark(function e(r,t,n){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getAddress();case 2:if(o=e.sent,!t){e.next=13;break}if(!o){e.next=9;break}return e.next=7,o.update(t,{transaction:n});case 7:e.next=11;break;case 9:return e.next=11,r.createAddress(t,{transaction:n});case 11:e.next=16;break;case 13:if(!o){e.next=16;break}return e.next=16,o.destroy({transaction:n});case 16:return e.abrupt("return",r.reload({transaction:n,include:[{model:a.d}]}));case 17:case"end":return e.stop()}},e,this)}));return function(r,t,n){return e.apply(this,arguments)}}();r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){var n,u,s,i,c,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,u=r.params.id,s=r.transaction,n&&(!n.id||""+n.id===u)){e.next=7;break}return e.next=6,s.rollback();case 6:return e.abrupt("return",t.status(400).send({error:"ID mismatch"}));case 7:return delete n.id,e.next=10,a.b.findOne({where:{id:u},include:[{model:a.d}],transaction:s});case 10:if(i=e.sent){e.next=15;break}return e.next=14,s.rollback();case 14:return e.abrupt("return",t.status(404).send({error:"not found"}));case 15:return c="address"in n,f=n.address,delete n.address,e.next=20,i.update(n,{transaction:s});case 20:if(d=e.sent,!c){e.next=25;break}return e.next=24,o(d,f,s);case 24:d=e.sent;case 25:return e.next=27,s.commit();case 27:return e.abrupt("return",t.status(200).send(d.toJSON()));case 28:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){var n,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,o=r.transaction,!n.id){e.next=6;break}return e.next=5,o.rollback();case 5:return e.abrupt("return",t.status(422).send({error:"explicit value provided for id"}));case 6:return e.next=8,a.b.create(n,{transaction:o});case 8:if(u=e.sent,!n.address){e.next=12;break}return e.next=12,u.createAddress(n.address,{transaction:o});case 12:return e.next=14,o.commit();case 14:return e.abrupt("return",t.set("Location","/schools/"+u.id).status(201).send(u.toJSON()));case 15:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(4);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,n){var u,s,i,c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.transaction,s=[{model:a.d}],e.next=4,a.b.findAndCount(t.i(o.a)(r.query,{transaction:u,include:s},a.b));case 4:return i=e.sent,c=i.rows,f=i.count,e.next=9,u.commit();case 9:return e.abrupt("return",n.send({count:f,results:c.map(function(e){return e.toJSON()})}));case 10:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";function n(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function a(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var o=t(0),u=t(4),s=this,i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},c=function(){var e=a(regeneratorRuntime.mark(function e(r,a){var c,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.transaction,f=t.i(u.a)(r.query,{transaction:c,where:{schoolId:r.user.schoolId}},o.c),null==f.where&&a.status(400).send(),f.where.id?f.where.id.constructor===Object?(f.where.id=i({},f.where.id,{$notIn:[].concat(n(f.where.id.$ne?[f.where.id.$ne]:[]),n(f.where.id.$notIn&&Array.isArray(f.where.id.$notIn)?f.where.id.$notIn:[]),[r.user.id])}),delete f.where.id.$ne):f.where.id={$in:Array.isArray(f.where.id)?f.where.id:[f.where.id],$ne:r.user.id}:f.where.id={$ne:r.user.id},e.next=6,o.c.destroy(f);case 6:return e.next=8,c.commit();case 8:a.status(204).send();case 9:case"end":return e.stop()}},e,s)}));return function(r,t){return e.apply(this,arguments)}}(),f=function(){var e=a(regeneratorRuntime.mark(function e(r,t){var n,a,u,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.params.id,a=r.transaction,u=[],""+r.user.id!==n){e.next=7;break}return e.next=6,a.rollback();case 6:return e.abrupt("return",t.status(400).send({error:"bad request"}));case 7:return r.user.school&&u.push({model:o.b,where:{id:r.user.school.id}}),e.next=10,o.c.findOne({where:{id:n},transaction:a,include:u});case 10:if(!(i=e.sent)){e.next=17;break}return e.next=14,i.destroy({transaction:a});case 14:return e.next=16,a.commit();case 16:return e.abrupt("return",t.status(204).send());case 17:return e.next=19,a.rollback();case 19:return e.abrupt("return",t.status(404).send());case 20:case"end":return e.stop()}},e,s)}));return function(r,t){return e.apply(this,arguments)}}();r.a=function(e,r){return"id"in e.params?f(e,r):c(e,r)}},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(7);r.a=function(){function e(e,t,n){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,n,u){var s,i,c,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:s=r.transaction,i=r.params.id,c={model:a.b},f=[{model:a.d},{model:a.a},c],e.t0=r.user.type,e.next="ADMIN"===e.t0?7:"TEACHER"===e.t0?8:10;break;case 7:return e.abrupt("break",11);case 8:return c.where={id:r.user.school.id},e.abrupt("break",11);case 10:return e.abrupt("return",u(new RangeError("unhandled case: "+r.user.type)));case 11:return e.next=13,a.c.findOne({where:{id:i},include:f,transaction:s});case 13:if(!(d=e.sent)){e.next=18;break}return e.next=17,s.commit();case 17:return e.abrupt("return",n.send(t.i(o.a)(d)));case 18:return e.next=20,s.rollback();case 20:return e.abrupt("return",n.status(404).send({error:"not found"}));case 21:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";var n=t(2),a=(t.n(n),t(48)),o=t(49),u=t(51),s=t(52),i=t(53),c=t(6),f=t.i(n.Router)();f.route("/").get(t.i(c.a)(i.a)).post(t.i(c.a)(s.a)).patch(t.i(c.a)(u.a)).delete(t.i(c.a)(a.a)),f.route("/:id").delete(t.i(c.a)(a.a)).get(t.i(c.a)(o.a)).patch(t.i(c.a)(u.a)),r.a=f},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(5),u=this,s=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},i=function(){var e=n(regeneratorRuntime.mark(function e(r,t,i,c,f){var d,l,p,h,v=function(){var e=n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==["TEACHER","ADMIN"].indexOf(h.type)&&"email"in d){e.next=2;break}return e.abrupt("return");case 2:if(d.email){e.next=4;break}throw new o.c;case 4:return e.next=6,a.e.findOne({where:{username:h.email},transaction:r});case 6:if(null==(t=e.sent)){e.next=10;break}return e.next=10,t.update({email:d.email},{transaction:r});case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),m=function(){var e=n(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=2;break}return e.abrupt("return");case 2:if(!f||!f[l]){e.next=4;break}return e.abrupt("return");case 4:return t=a.a.findOne({where:{id:l},include:[{model:a.b,where:{id:h.schoolId}}],transaction:r}),f&&(f[l]=t),e.next=8,t;case 8:if(null!=(n=e.sent)){e.next=11;break}throw new o.a;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=n(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!d.address){e.next=9;break}return e.next=3,h.getAddress({transaction:r});case 3:if(!(t=e.sent)){e.next=6;break}return e.abrupt("return",t.update(c.address,{transaction:r}));case 6:return e.abrupt("return",h.createAddress(c.address,{transaction:r}));case 9:if(!("address"in c)){e.next=11;break}return e.abrupt("return",h.setAddress(null,{transaction:r}));case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}throw new o.c;case 2:return d=s({},c),d.dob&&(d.dob=new Date(d.dob)),delete d.type,delete d.school,delete d.schoolId,delete d.addressId,delete d.activationSent,l=d.groupId||(d.group||{}).id,l?d.groupId=l:("groupId"in d||"group"in d&&null==d.group)&&(d.groupId=null),delete d.group,p={id:i},t&&(p.schoolId=t),e.next=16,a.c.findOne({where:p,transaction:r});case 16:if(null!=(h=e.sent)){e.next=19;break}throw new o.a;case 19:return e.next=21,Promise.all([m(),b(),v()]);case 21:return e.abrupt("return",h.update(d,{transaction:r,include:[{model:a.d},{model:a.a}]}));case 22:case"end":return e.stop()}},e,u)}));return function(r,t,n,a,o){return e.apply(this,arguments)}}(),c=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.params.id,a=r.body,!a.id||""+a.id===n){e.next=4;break}throw new o.c;case 4:return s=r.transaction,e.next=7,i(r.transaction,r.user.schoolId,n,a);case 7:return c=e.sent,e.next=10,s.commit();case 10:return e.abrupt("return",t.send(c));case 11:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}(),f=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,a,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.body,a=r.transaction,Array.isArray(n)){e.next=4;break}throw new o.c("id not specified");case 4:return s={},e.next=7,Promise.all(n.map(function(e){return i(a,r.user.schoolId,(e||{}).id,e||{},s)}));case 7:return c=e.sent,e.next=10,a.commit();case 10:return e.abrupt("return",t.send(c.map(function(e){return e.toJSON()})));case 11:case"end":return e.stop()}},e,u)}));return function(r,t){return e.apply(this,arguments)}}();r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!("id"in r.params)){e.next=2;break}return e.abrupt("return",c(r,t));case 2:return e.abrupt("return",f(r,t));case 3:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}function a(e,r,t,n){if(null==e||null!=e.id)return t.status(400).send({error:"bad request"}),!1;switch(r.user.type){case"ADMIN":return-1===["TEACHER","LEADER","STUDENT"].indexOf(e.type)||null!=e.school||null!=e.schoolId||(t.status(400).send({error:"incorrect user type provided"}),!1);case"TEACHER":return-1!==["STUDENT","LEADER"].indexOf(e.type)||(t.status(400).send({error:"incorrect user type provided"}),!1);default:return n(new RangeError("unhandled case: "+r.user.type)),!1}}function o(e,r,t){return Array.isArray(e.body)?d(e,r,t):l(e,r,t)}r.a=o;var u=t(0),s=t(1),i=function(){function e(e,r){var t=[],n=!0,a=!1,o=void 0;try{for(var u,s=e[Symbol.iterator]();!(n=(u=s.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},f=function(){var e=n(regeneratorRuntime.mark(function e(r,t){var n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c({},r),delete n.group,delete n.activationSent,e.next=5,u.c.create(r,{transaction:t,include:[{model:u.a},{model:u.b},{model:u.d}]});case 5:if(a=e.sent,!r.address){e.next=9;break}return e.next=9,a.createAddress(r.address,{transaction:t});case 9:return e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return function(r,t){return e.apply(this,arguments)}}(),d=function(){var e=n(regeneratorRuntime.mark(function e(r,t,n){var o,f,d,l,p,h,v,m,b,w,x,y,g,R,k,I,A,S,E,N;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=r.body,f=r.transaction,d=void 0,l={},p=[],h=0,v=o[h];case 6:if(!(h<o.length)){e.next=20;break}if(a(v,r,t,n)){e.next=10;break}return d=!0,e.abrupt("break",20);case 10:v.dob&&(v.dob=new Date(v.dob)),r.user.school&&(v.schoolId=r.user.schoolId),m=v.groupId||(v.group||{}).id,m&&(l[m]=!0),v.address&&p.push(v.address),delete v.group,delete v.activationSent;case 17:h+=1,v=o[h],e.next=6;break;case 20:if(!d){e.next=24;break}return e.next=23,f.rollback();case 23:return e.abrupt("return");case 24:return e.next=26,u.d.bulkCreate(p,{transaction:f});case 26:return b=e.sent,e.next=29,s.a.query("SELECT LAST_INSERT_ID() addressId;",{transaction:f});case 29:return w=e.sent,x=i(w,1),y=i(x[0],1),g=y[0].addressId,R={},k=o.map(function(e){var r=c({},e);return e.address&&(r.addressId=g,R[g]=b.shift().toJSON(),R[g].id=g,g+=1),r}),e.next=37,u.c.bulkCreate(k,{transaction:f});case 37:return I=e.sent,e.next=40,s.a.query("SELECT LAST_INSERT_ID() userId;",{transaction:f});case 40:return A=e.sent,S=i(A,1),E=i(S[0],1),N=E[0].userId,e.next=46,f.commit();case 46:t.send(I.map(function(e,r){return c({},e.toJSON(),{id:N+r,address:R[e.addressId],group:l[e.groupId]})}));case 47:case"end":return e.stop()}},e,this)}));return function(r,t,n){return e.apply(this,arguments)}}(),l=function(){var e=n(regeneratorRuntime.mark(function e(r,t,n){var o,s,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.body,a(o,r,t,n)){e.next=5;break}return e.next=4,r.transaction.rollback();case 4:return e.abrupt("return");case 5:return o.dob&&(o.dob=new Date(o.dob)),r.user.school&&(o.schoolId=r.user.school.id),e.next=9,f(o,r.transaction);case 9:return s=e.sent,e.next=12,s.reload({transaction:r.transaction,include:[{model:u.a},{model:u.d}]});case 12:return i=e.sent,e.next=15,r.transaction.commit();case 15:t.status(201).set("Location","/api/users/"+s.id).send(i.toJSON());case 16:case"end":return e.stop()}},e,this)}));return function(r,t,n){return e.apply(this,arguments)}}()},function(e,r,t){"use strict";function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(a,o){try{var u=r[a](o),s=u.value}catch(e){return void t(e)}if(!u.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}return n("next")})}}var a=t(0),o=t(7),u=t(4);r.a=function(){function e(e,t){return r.apply(this,arguments)}var r=n(regeneratorRuntime.mark(function e(r,n){var s,i,c,f,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=[{model:a.d},{model:a.a},{model:a.b,where:r.user.school?{id:r.user.school.id}:void 0}],i=r.transaction,e.next=4,a.c.findAndCount(t.i(u.a)(r.query,{transaction:i,include:s},a.c));case 4:return c=e.sent,f=c.rows,d=c.count,e.next=9,i.commit();case 9:return e.abrupt("return",n.send({count:d,results:f.map(o.a)}));case 10:case"end":return e.stop()}},e,this)}));return e}()},function(e,r,t){"use strict";var n=t(2),a=(t.n(n),t(40)),o=t(55);r.a=(new n.Router).use("/api",a.a).use("/",o.a)},function(e,r,t){"use strict";var n=t(20),a=(t.n(n),t(23)),o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},u="production"===process.env.NODE_ENV,s=u?"/public/build/bundle.js":"http://localhost:"+process.env.PROXY_PORT+"/hot-reload-server/bundle.js";r.a=function(e,r){var u=e.user?e.user.toJSON():null,i=u?t.i(n.normalize)(u,a.a):{entities:{},result:null},c=o({},r.initialState,{entities:i.entities,authorization:{loggingIn:!1,logInFailed:!1,logInUnsent:!1,user:i.result}}),f={title:"Boomerang Project",lang:"en",bundlePath:s,markup:"",initialState:JSON.stringify(c).replace(/</g,"\\u003c")};return r.render("index",f)}},function(e,r,t){"use strict";function n(e){var r=e.address(),t="string"==typeof r?"pipe "+r:"port "+r.port;b("Listening on "+t)}function a(e){if("listen"!==e.syscall)throw e;var r="string"==typeof v?"Pipe "+v:"Port "+v;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}}function o(e){e.set("port",v);var r=f.a.createServer(e);r.listen(v),r.on("error",a),r.on("listening",function(){return n(r)})}function u(e){if(l.a.isMaster&&"production"===process.env.NODE_ENV)for(var r=0;r<m;r+=1)l.a.fork();else o(e)}r.a=u;var s=t(61),i=t.n(s),c=t(62),f=t.n(c),d=t(58),l=t.n(d),p=t(65),h=t.n(p),v=process.env.PORT,m=h.a.cpus().length,b=i()("mern:server")},function(e,r){e.exports=require("body-parser")},function(e,r){e.exports=require("cluster")},function(e,r){e.exports=require("compression")},function(e,r){e.exports=require("cookie-parser")},function(e,r){e.exports=require("debug")},function(e,r){e.exports=require("http")},function(e,r){e.exports=require("morgan")},function(e,r){e.exports=require("nodemailer")},function(e,r){e.exports=require("os")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("serve-favicon")},function(e,r,t){t(22),e.exports=t(21)}]);